<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
   
    <link href="css/bootstrap.min.css" rel="stylesheet" />

</head>
<body>
    <div class="container">
        <h1>Description</h1>
        <p style="font-size:20px;text-align:justify;font-family:'Comic Sans MS'">
            In this Experiment, I initialized <code>passportjs and passport-local</code>, Using th local strategy to let user maintain their loggedin after they registered
        </p><hr />
        <img src="img/register.jpg" width="900" height="500"/><br />
        <a href="http://nodejs-gx72xk.rhcloud.com/signup.html#/home" style="font-size:30px;">Link to Openshift</a>

        <div>
            <h1>Code Snippet</h1>
            <h3>PassportJS</h3>
            <p><code>var LocalStrategy = require('passport-local').Strategy;</code> to import local strategy</p>
            <pre> 
   passport.use(new LocalStrategy(
   function (username, password, done) {
    UserModel.findOne({ username: username, password: password }, function (err, user) {
        if (err) { return done(err); }
        if (!user) { return done(null, false); }
        return done(null, user);
    })
}));
passport.serializeUser(function (user, done) {
    done(null, user);
});
passport.deserializeUser(function (user, done) {
    done(null, user);
});

                app.post('/register', function (req, res) {
    var newUser = req.body;
    UserModel.findOne({ username: newUser.username }, function (err, user) {
        if (err) { return next(err); }
        if (user) {
            res.json(null);
            return;
        }
        var newUser = new UserModel(req.body);
        newUser.save(function (err, user) {
            req.login(user, function (err) {
                if (err) { return next(err); }
                res.json(user);
            });
        });
    });
});
                                                                                   
</pre>
            
            <h3>AngularJs</h3>
            <pre> 
                $scope.register = function (user) {
        console.log(user);
        if (user.password != user.password2 || !user.password || !user.password2) {
            $rootScope.message = "Your passwords don't match";
            alert("password don't match!")
        }
        else {
            $http.post("/register", user)
            .success(function (response) {
                console.log(response);
               
                if (response != null) {
                    $rootScope.currentUser = response;
                    $('#myModal').modal('hide');
 
                    $location.url("/profile");
                }
            });
        }
    }
</pre>
        </div>
        <div>
            <div class="panel-footer">
                <div class="container">
                    <div class="footer">
                        <label>References</label><br />
                        <a href="https://angularjs.org/">Angular</a><br />
                        <a href="http://passportjs.org/">PassportJS</a><br />
                    </div>
                    <div class="footer">
                        <label>Source Code</label><br />
                        <a href="https://github.com/gx72xk/Cs5610-Kai-Xiang">GitHub-openshift(under openshift/nodejs)</a>
                    
                    </div> 
                </div>
            </div>
        </div>
    </div>
</body>
</html>
